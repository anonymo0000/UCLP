# -*- coding: utf-8 -*-
"""
Created on Wed Mar  8 21:36:39 2023

@author: hanly2
"""
import openai
openai.api_key = "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"
def ask_chatgpt(prompt):
    a = openai.ChatCompletion.create(
      model="gpt-3.5-turbo",
      messages=[
            {"role": "system", "content": "You are an expert in the field of software vulnerability."},
            {"role": "user", "content": prompt}
        ]
    )
    return a['choices'][0].message['content'].strip()
def class_chatgpt(vulnerability_text):
    prompt = 'Task: Please select the most appropriate label for vulnerability text from the vulnerability type options.\nvulnerability type options: A: Cross site scripting; B: SQL injection; C: Buffer Overflow; D: Directory Traversal; E: Cross-site request forgery; F: PHP file inclusion; G: Use-after-free; H: Integer overflow; I: Untrusted search path; J: Format string; K: CRLF injection; L: XML External Entity; M: Others.\nvulnerability text: '
    prompt = prompt + vulnerability_text + '\n' + 'vulnerability type of vulnerability text:'
    res = ask_chatgpt(prompt)
    if 'Buffer Overflow' in res:
        return 'Buffer Overflow'
    elif 'SQL injection' in res:
        return 'SQL injection'
    elif 'Cross site scripting' in res:
        return 'Cross site scripting'
    elif 'Directory Traversal' in res:
        return 'Directory Traversal'
    elif 'Cross-site request forgery' in res:
        return 'Cross-site request forgery'
    elif 'PHP file inclusion' in res:
        return 'PHP file inclusion'
    elif 'Use-after-free' in res:
        return 'Use-after-free'
    elif 'Integer overflow' in res:
        return 'Integer overflow'
    elif 'Untrusted search path' in res:
        return 'Untrusted search path'
    elif 'Format string' in res:
        return 'Format string'   
    elif 'CRLF injection' in res:
        return 'CRLF injection'
    elif 'XML External Entity' in res:
        return 'XML External Entity'
    else:
        return 'Others'      
    return ask_chatgpt(prompt)
a = class_chatgpt('Apple Safari 1.0 through 1.1 on Mac OS X 10.3.1 and Mac OS X 10.2.8 ')